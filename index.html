<!doctype html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1"
    />
    <title>Productivity Tracker</title>
     Tailwind CSS (Play CDN for quick prototyping) 
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      // Tailwind config to ensure consistent palette
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              brand: {
                50: '#ecfeff',
                100: '#cffafe',
                200: '#a5f3fc',
                300: '#67e8f9',
                400: '#22d3ee',
                500: '#06b6d4',
                600: '#0891b2', // primary
                700: '#0e7490',
                800: '#155e75',
                900: '#164e63',
              },
            },
          },
        },
      }
    </script>
     React, ReactDOM, and Babel for JSX in the browser 
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="h-full bg-gray-50 text-gray-900 font-sans antialiased">
    <header class="bg-brand-600 text-white">
      <div class="mx-auto max-w-3xl px-4 py-4">
        <h1 class="text-xl font-semibold text-balance">Productivity & Habit Tracker</h1>
        <p class="text-sm opacity-90">Track daily habits, streaks, and weekly progress</p>
      </div>
    </header>

    <main id="root" class="mx-auto max-w-3xl px-4 py-6"></main>

    <script type="text/babel">
      const { useEffect, useMemo, useState } = React

      // Utilities
      const pad = (n) => (n < 10 ? '0' + n : '' + n)
      const toKey = (d) => {
        const y = d.getFullYear()
        const m = pad(d.getMonth() + 1)
        const day = pad(d.getDate())
        return `${y}-${m}-${day}`
      }
      const todayKey = () => toKey(new Date())

      const lastNDays = (n) => {
        const days = []
        const now = new Date()
        for (let i = n - 1; i >= 0; i--) {
          const d = new Date(now)
          d.setDate(now.getDate() - i)
          days.push(d)
        }
        return days
      }

      const loadHabits = () => {
        try {
          const raw = localStorage.getItem('habits_v1')
          return raw ? JSON.parse(raw) : []
        } catch {
          return []
        }
      }

      const saveHabits = (habits) => {
        localStorage.setItem('habits_v1', JSON.stringify(habits))
      }

      // Calculate streak (consecutive days up to today with completion true)
      const computeStreak = (habit) => {
        let streak = 0
        const days = lastNDays(365) // up to a year lookback
        for (let i = days.length - 1; i >= 0; i--) {
          const key = toKey(days[i])
          if (habit.history && habit.history[key]) {
            streak += 1
          } else {
            // break on first miss from today backwards
            if (toKey(days[i]) === todayKey() || streak > 0) break
          }
        }
        return streak
      }

      // Components

      function StatBadge({ label, value }) {
        return (
          <div className="flex-1 rounded-lg border border-gray-200 bg-white p-4">
            <div className="text-xs uppercase tracking-wide text-gray-500">{label}</div>
            <div className="mt-1 text-2xl font-semibold">{value}</div>
          </div>
        )
      }

      function WeeklyChart({ data, max }) {
        // data: [{ label, value }]
        const safeMax = Math.max(1, max)
        return (
          <div className="rounded-lg border border-gray-200 bg-white p-4">
            <div className="mb-3 flex items-center justify-between">
              <h3 className="text-sm font-medium">Weekly Completion</h3>
              <span className="text-xs text-gray-500">Last 7 days</span>
            </div>
            <div className="grid grid-cols-7 gap-2 items-end h-36">
              {data.map((d) => {
                const pct = Math.round((d.value / safeMax) * 100)
                return (
                  <div key={d.label} className="flex flex-col items-center gap-2">
                    <div
                      className="w-full rounded-md bg-brand-600/80 transition-all"
                      style={{ height: `${pct}%`, minHeight: d.value > 0 ? '8px' : '0px' }}
                      aria-label={`${d.label}: ${d.value} completions`}
                      role="img"
                    />
                    <div className="text-xs text-gray-600">{d.label}</div>
                  </div>
                )
              })}
            </div>
            <div className="mt-2 text-xs text-gray-500">
              Max per-day completions this week: {safeMax}
            </div>
          </div>
        )
      }

      function AddHabit({ onAdd }) {
        const [name, setName] = useState('')
        return (
          <form
            onSubmit={(e) => {
              e.preventDefault()
              const trimmed = name.trim()
              if (!trimmed) return
              onAdd(trimmed)
              setName('')
            }}
            className="flex items-center gap-2"
          >
            <input
              type="text"
              value={name}
              onChange={(e) => setName(e.target.value)}
              placeholder="Add a new habit (e.g., Read 10 pages)"
              className="w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm outline-none focus:border-brand-600 focus:ring-2 focus:ring-brand-600/20"
              aria-label="Habit name"
            />
            <button
              type="submit"
              className="rounded-md bg-brand-600 px-3 py-2 text-sm font-medium text-white hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-brand-600/40"
            >
              Add
            </button>
          </form>
        )
      }

      function Filters({ filter, setFilter, counts }) {
        const Btn = ({ id, children }) => (
          <button
            onClick={() => setFilter(id)}
            className={[
              'rounded-md border px-3 py-1.5 text-sm transition',
              filter === id
                ? 'border-brand-600 bg-brand-600 text-white'
                : 'border-gray-300 bg-white text-gray-700 hover:bg-gray-50',
            ].join(' ')}
            aria-pressed={filter === id}
          >
            <span className="font-medium">{children}</span>
            <span className="ml-2 rounded bg-gray-100 px-1.5 py-0.5 text-xs text-gray-600">
              {counts[id] ?? 0}
            </span>
          </button>
        )
        return (
          <div className="flex flex-wrap items-center gap-2">
            <Btn id="today">Today</Btn>
            <Btn id="completed">Completed</Btn>
            <Btn id="pending">Pending</Btn>
          </div>
        )
      }

      function HabitItem({ habit, todayDone, onToggleToday, onDelete }) {
        const streak = computeStreak(habit)
        return (
          <li className="flex items-center justify-between rounded-md border border-gray-200 bg-white px-3 py-2">
            <div className="flex items-center gap-3">
              <input
                id={`habit-${habit.id}`}
                type="checkbox"
                checked={!!todayDone}
                onChange={(e) => onToggleToday(habit.id, e.target.checked)}
                className="h-4 w-4 rounded border-gray-300 text-brand-600 focus:ring-brand-600"
                aria-label={`Mark "${habit.name}" as done today`}
              />
              <label
                htmlFor={`habit-${habit.id}`}
                className={['text-sm', todayDone ? 'line-through text-gray-500' : 'text-gray-800'].join(' ')}
              >
                {habit.name}
              </label>
            </div>

            <div className="flex items-center gap-3">
              <span
                title="Current streak"
                className="rounded-full bg-gray-100 px-2 py-1 text-xs font-medium text-gray-700"
              >
                ðŸ”¥ {streak} day{streak === 1 ? '' : 's'}
              </span>
              <button
                onClick={() => onDelete(habit.id)}
                className="rounded-md border border-gray-300 px-2 py-1 text-xs text-gray-600 hover:bg-gray-50"
                aria-label={`Delete habit ${habit.name}`}
              >
                Delete
              </button>
            </div>
          </li>
        )
      }

      function HabitList({ habits, filter, onToggleToday, onDelete }) {
        const tKey = todayKey()

        const filtered = habits.filter((h) => {
          const done = !!(h.history && h.history[tKey])
          if (filter === 'completed') return done
          if (filter === 'pending') return !done
          return true // 'today'
        })

        if (filtered.length === 0) {
          return (
            <div className="rounded-md border border-dashed border-gray-300 bg-white p-6 text-center text-sm text-gray-600">
              {habits.length === 0
                ? 'No habits yet. Add your first habit above.'
                : 'No habits match this filter.'}
            </div>
          )
        }

        return (
          <ul className="flex flex-col gap-2">
            {filtered.map((h) => (
              <HabitItem
                key={h.id}
                habit={h}
                todayDone={!!(h.history && h.history[tKey])}
                onToggleToday={onToggleToday}
                onDelete={onDelete}
              />
            ))}
          </ul>
        )
      }

      function App() {
        const [habits, setHabits] = useState(loadHabits)
        const [filter, setFilter] = useState('today')

        useEffect(() => {
          saveHabits(habits)
        }, [habits])

        const tKey = todayKey()

        const counts = useMemo(() => {
          const total = habits.length
          const completed = habits.filter((h) => h.history && h.history[tKey]).length
          const pending = total - completed
          return { today: total, completed, pending }
        }, [habits, tKey])

        const weeklyData = useMemo(() => {
          const days = lastNDays(7)
          const bars = days.map((d) => {
            const key = toKey(d)
            const dow = d.toLocaleDateString(undefined, { weekday: 'short' })
            const value = habits.reduce((acc, h) => acc + (h.history && h.history[key] ? 1 : 0), 0)
            return { label: dow, value }
          })
          const max = bars.reduce((m, b) => Math.max(m, b.value), 0)
          return { bars, max }
        }, [habits])

        const addHabit = (name) => {
          const newHabit = {
            id: `${Date.now()}_${Math.random().toString(36).slice(2, 7)}`,
            name,
            createdAt: tKey,
            history: {},
          }
          setHabits((prev) => [newHabit, ...prev])
        }

        const toggleToday = (id, done) => {
          setHabits((prev) =>
            prev.map((h) => {
              if (h.id !== id) return h
              const history = { ...(h.history || {}) }
              if (done) {
                history[tKey] = true
              } else {
                delete history[tKey]
              }
              return { ...h, history }
            })
          )
        }

        const deleteHabit = (id) => {
          setHabits((prev) => prev.filter((h) => h.id !== id))
        }

        return (
          <div className="flex flex-col gap-6">
            {/* Top summary */}
            <section className="grid grid-cols-1 gap-3 sm:grid-cols-3">
              <StatBadge label="Habits (Today)" value={counts.today} />
              <StatBadge label="Completed (Today)" value={counts.completed} />
              <StatBadge
                label="Completion Rate"
                value={
                  counts.today === 0
                    ? 'â€”'
                    : `${Math.round((counts.completed / Math.max(1, counts.today)) * 100)}%`
                }
              />
            </section>

            {/* Add + Filters */}
            <section className="flex flex-col gap-3 rounded-lg border border-gray-200 bg-white p-4">
              <AddHabit onAdd={addHabit} />
              <div className="flex items-center justify-between">
                <Filters filter={filter} setFilter={setFilter} counts={counts} />
                <div className="text-xs text-gray-500">
                  Today: <span className="font-mono">{tKey}</span>
                </div>
              </div>
            </section>

            {/* List */}
            <section>
              <HabitList
                habits={habits}
                filter={filter}
                onToggleToday={toggleToday}
                onDelete={deleteHabit}
              />
            </section>

            {/* Analytics */}
            <section>
              <WeeklyChart data={weeklyData.bars} max={weeklyData.max} />
            </section>

            <footer className="py-6 text-center text-xs text-gray-500">
              Built with React and Tailwind CSS â€¢ Data saved in your browser (localStorage)
            </footer>
          </div>
        )
      }

      const root = ReactDOM.createRoot(document.getElementById('root'))
      root.render(<App />)
    </script>
  </body>
</html>
